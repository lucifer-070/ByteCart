erDiagram
  %% ByteCart ERD

  USERS ||--o{ ADDRESSES : has
  CATEGORIES ||--o{ CATEGORIES : parent_of
  CATEGORIES ||--o{ PRODUCTS : groups
  PRODUCTS ||--o{ PRODUCT_VARIANTS : offers
  PRODUCT_VARIANTS ||--|| INVENTORIES : tracked_by
  USERS ||--o{ CARTS : owns
  CARTS ||--o{ CART_ITEMS : contains
  PRODUCT_VARIANTS ||--o{ CART_ITEMS : referenced_by
  USERS ||--o{ ORDERS : places
  ORDERS ||--o{ ORDER_ITEMS : contains
  PRODUCT_VARIANTS ||--o{ ORDER_ITEMS : referenced_by
  ORDERS ||--|| PAYMENTS : settles
  USERS ||--o{ REVIEWS : writes
  PRODUCTS ||--o{ REVIEWS : receives

  USERS {
    int user_id PK
    varchar email UK
    varchar password_hash
    varchar full_name
    varchar phone
    boolean is_active
    timestamp created_at
  }

  ADDRESSES {
    int address_id PK
    int user_id FK
    varchar label
    varchar recipient_name
    varchar line1
    varchar line2
    varchar city
    varchar state
    varchar postal_code
    char country  %% ISO-3166-1 alpha-2
    boolean is_default
  }

  CATEGORIES {
    int category_id PK
    int parent_id FK
    varchar name
    varchar slug UK
    boolean is_active
  }

  PRODUCTS {
    int product_id PK
    int category_id FK
    varchar name
    varchar slug UK
    text description
    decimal base_price
    boolean is_active
    timestamp created_at
  }

  PRODUCT_VARIANTS {
    int variant_id PK
    int product_id FK
    varchar sku UK
    json attrs
    decimal price_override  %% null => use base_price
  }

  INVENTORIES {
    int inventory_id PK
    int variant_id FK UK
    int qty_available
  }

  CARTS {
    int cart_id PK
    int user_id FK
    enum status    %% active|converted|abandoned
    timestamp created_at
    timestamp updated_at
  }

  CART_ITEMS {
    int cart_item_id PK
    int cart_id FK
    int variant_id FK
    int quantity
    decimal unit_price
  }

  ORDERS {
    int order_id PK
    int user_id FK
    enum status    %% pending|paid|cancelled|failed
    timestamp placed_at
    char currency  %% ISO-4217 (3)
    decimal total_amount
    json shipping_address
  }

  ORDER_ITEMS {
    int order_item_id PK
    int order_id FK
    int variant_id FK
    varchar product_name
    varchar sku
    decimal unit_price
    int quantity
    decimal line_total
  }

  PAYMENTS {
    int payment_id PK
    int order_id FK UK
    varchar provider
    decimal amount
    enum status    %% initiated|succeeded|failed
    varchar txn_ref
    timestamp paid_at
  }

  REVIEWS {
    int review_id PK
    int user_id FK
    int product_id FK
    int rating      %% 1..5
    varchar title
    text body
    enum status     %% published|hidden
    timestamp created_at
    timestamp updated_at
    %% UNIQUE (user_id, product_id)
  }
